rest-express@1.0.0 dev
Servizio gestione telefono diretto inizializzato
Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
✅ Icona Fleur de Vie caricata: 611937 bytes
✅ Storage inizializzato in app.locals: object metodi disponibili: sessionStore
Telefono caricato dal database: +393472550110
Utenti già presenti nel sistema. Nessun account predefinito creato.
Scheduler dei promemoria avviato con successo
Tutti gli scheduler inizializzati
🔍 Controllo integrità all'avvio:
   📅 Appuntamenti caricati: 48
   👥 Clienti caricati: 40
   🔍 Primi 3 appuntamenti: [
  { id: 1750059544768, date: '2025-06-18', client: 252 },
  { id: 1750064999602, date: '2025-06-19', client: 251 },
  { id: 1750065026422, date: '2025-06-19', client: 1 }
]
✅ Controllo integrità completato
8:45:08 AM [express] serving on port 5000
Browserslist: browsers data (caniuse-lite) is 12 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
Esecuzione immediata del job di promemoria all'avvio del server
🗓️ [NOTIFICHE JSON] Utilizzo filtro condiviso per appuntamenti di domani
🗓️ [JSON STORAGE] Trovati 1 appuntamenti per domani (Thu Oct 09 2025)
Trovati 0 appuntamenti di domani che necessitano di promemoria automatici
Inviati 0/0 promemoria
Job iniziale completato: inviati 0 promemoria
8:45:18 AM [express] GET /api/timezone-settings 200 in 5ms :: {"timezone":"Europe/Rome","offset":2}
8:45:18 AM [express] GET /api/timezone-settings 304 in 0ms :: {"timezone":"Europe/Rome","offset":2}
8:45:18 AM [express] GET /api/user-with-license 401 in 1ms :: {"message":"Non autenticato"}
8:45:18 AM [express] POST /api/timezone-settings 200 in 1ms :: {"success":true,"timezone":"UTC","off…
8:45:18 AM [express] POST /api/timezone-settings 200 in 0ms :: {"success":true,"timezone":"UTC","off…
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
8:45:25 AM [express] GET /api/timezone-settings 200 in 143ms :: {"timezone":"Europe/Rome","offset":2}
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
8:45:25 AM [express] GET /api/user-with-license 200 in 234ms :: {"id":9,"username":"zambelli.andrea.…
8:45:25 AM [express] GET /api/timezone-settings 304 in 145ms :: {"timezone":"Europe/Rome","offset":2}
8:45:25 AM [express] POST /api/timezone-settings 200 in 144ms :: {"success":true,"timezone":"Europe/…
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
8:45:25 AM [express] GET /api/tenant-context 200 in 155ms :: {"userId":9,"userType":"customer","tena…
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
🏢 [/api/company-name-settings] [desktop] GET per utente 9 (customer)
🏢 [/api/company-name-settings] [desktop] Settings per utente 9 (customer): {
  businessName: 'Studio Medico',
  showBusinessName: true,
  name: 'zambelli.andrea.1973A@gmail.com',
  fontSize: 24,
  fontFamily: 'Arial, sans-serif',
  fontStyle: 'normal',
  color: '#000000',
  enabled: true
}
8:45:25 AM [express] GET /api/user-with-license 304 in 219ms :: {"id":9,"username":"zambelli.andrea.…
8:45:25 AM [express] GET /api/company-name-settings 200 in 145ms :: {"businessName":"Studio Medico",…
✅ Icone PWA aggiornate per utente 9 con logo aziendale
✅ [desktop] Icone PWA per utente 9, icon length: 815939
8:45:26 AM [express] GET /api/client-app-info 200 in 266ms :: {"appName":"Gestionale Sanitario","ico…
8:45:26 AM [express] GET /api/contact-info 200 in 155ms :: {"email":"info@studiomedico.it","phone":"…
Recupero licenze per l'utente ID 9
Trovate 1 licenze per l'utente 9
8:45:26 AM [express] GET /api/license/has-pro-access 304 in 141ms :: true
8:45:26 AM [express] GET /api/license/has-business-access 304 in 142ms :: true
8:45:26 AM [express] GET /api/license/license-info 304 in 213ms :: {"hasLicense":true,"type":"trial"…
✅ Icone PWA aggiornate per utente 9 con logo aziendale
✅ [desktop] Icone PWA per utente 9, icon length: 815939
8:45:26 AM [express] GET /api/license/application-title 304 in 143ms :: {"title":"Gestionale Sanitar…
8:45:26 AM [express] GET /api/client-app-info 200 in 239ms :: {"appName":"Gestionale Sanitario","ico…
🏢 [/api/company-name-settings] [desktop] GET per utente 9 (customer)
🏢 [/api/company-name-settings] [desktop] Settings per utente 9 (customer): {
  businessName: 'Studio Medico',
  showBusinessName: true,
  name: 'zambelli.andrea.1973A@gmail.com',
  fontSize: 24,
  fontFamily: 'Arial, sans-serif',
  fontStyle: 'normal',
  color: '#000000',
  enabled: true
}
8:45:26 AM [express] GET /api/company-name-settings 200 in 148ms :: {"businessName":"Studio Medico",…
8:45:26 AM [express] GET /api/contact-info 200 in 147ms :: {"email":"info@studiomedico.it","phone":"…
8:45:26 AM [express] POST /api/timezone-settings 200 in 152ms :: {"success":true,"timezone":"Europe/…
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
8:46:32 AM [express] GET /api/timezone-settings 200 in 144ms :: {"timezone":"Europe/Rome","offset":2}
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
8:46:32 AM [express] GET /api/user-with-license 200 in 213ms :: {"id":9,"username":"zambelli.andrea.…
8:46:32 AM [express] GET /api/payments/plans 200 in 213ms :: [{"id":5,"name":"Base Mensile","descrip…
🔐 MIDDLEWARE isAuthenticated chiamato per GET /subscription
🔐 req.isAuthenticated(): true
🔐 req.user: zambelli.andrea.1973A@gmail.com (ID: 9)
🔐 Session ID: UpxosApf5lEd1N_1RRQ631FMoJUEnmpc
🔐 Cookies: session-id=s%3AUpxosApf5lEd1N_1RRQ631FMoJUEnmpc.AVig47vPxPbyc%2BfPDWu4DgT%2F07RTi3nminnbpDLLxr8
✅ Utente autenticato con successo in isAuthenticated middleware: zambelli.andrea.1973A@gmail.com tipo: customer
Recupero sottoscrizione per l'utente con ID 9
Recupero licenze per l'utente ID 9
8:46:32 AM [express] GET /api/license/has-pro-access 304 in 141ms :: true
Trovate 1 licenze per l'utente 9
8:46:32 AM [express] GET /api/license/license-info 200 in 212ms :: {"hasLicense":true,"type":"trial"…
8:46:32 AM [express] GET /api/license/has-business-access 304 in 144ms :: true
8:46:32 AM [express] GET /api/license/application-title 304 in 140ms :: {"title":"Gestionale Sanitar…
8:46:32 AM [express] GET /api/payments/subscription 200 in 430ms :: {"id":12,"userId":9,"planId":7,"…
8:46:33 AM [express] GET /api/timezone-settings 304 in 145ms :: {"timezone":"Europe/Rome","offset":2}
8:46:33 AM [express] POST /api/timezone-settings 200 in 140ms :: {"success":true,"timezone":"Europe/…
8:46:33 AM [express] GET /api/tenant-context 200 in 140ms :: {"userId":9,"userType":"customer","tena…
🔍 PWA MANIFEST: Richiesta manifest dinamico
🔍 PWA MANIFEST: URL completo: /manifest.json
🔍 PWA MANIFEST: Query params: {}
🔍 PWA MANIFEST: Headers referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
📱 DEBUG MANIFEST FORZATO: CHIAMATA RICEVUTA
🔍 PWA MANIFEST: Referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
🔄 MANIFEST: Versione aggiornata: 1759913193254-default
🔍 PWA MANIFEST: Analizzando referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
🔍 PWA MANIFEST: Query params: {}
📱 MANIFEST DINAMICO: Servendo manifest per Studio Medico (owner default)
📱 MANIFEST ICONE: ["/pwa-icon/96x96?owner=default&v=1759913193254.168&android=1","/pwa-icon/192x192?owner=default&v=1759913193254.168&android=1","/pwa-icon/512x512?owner=default&v=1759913193254.168&android=1"]
📱 MANIFEST ID: area-cliente-generic
📱 MANIFEST NAME: Studio Medico - Area Cliente
8:46:33 AM [express] POST /api/timezone-settings 200 in 142ms :: {"success":true,"timezone":"Europe/…
8:46:33 AM [express] GET /api/timezone-settings 200 in 140ms :: {"timezone":"Europe/Rome","offset":2}
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
Recupero licenze per l'utente ID 9
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
Trovate 1 licenze per l'utente 9
8:46:33 AM [express] GET /api/license/has-pro-access 304 in 145ms :: true
8:46:33 AM [express] GET /api/user-with-license 304 in 216ms :: {"id":9,"username":"zambelli.andrea.…
8:46:33 AM [express] GET /api/license/license-info 304 in 214ms :: {"hasLicense":true,"type":"trial"…
✅ Icone PWA aggiornate per utente 9 con logo aziendale
✅ [desktop] Icone PWA per utente 9, icon length: 815939
8:46:33 AM [express] GET /api/client-app-info 200 in 255ms :: {"appName":"Gestionale Sanitario","ico…
8:46:33 AM [express] GET /api/license/has-business-access 304 in 149ms :: true
8:46:33 AM [express] GET /api/license/application-title 304 in 141ms :: {"title":"Gestionale Sanitar…
🖼️ ICON PROXY: Richiesta icona 192x192 per owner default
✅ ICON PROXY: Servendo icona 192x192 per owner default, dimensione: 50811 bytes
8:46:33 AM [express] GET /api/timezone-settings 304 in 156ms :: {"timezone":"Europe/Rome","offset":2}
8:46:34 AM [express] POST /api/timezone-settings 200 in 145ms :: {"success":true,"timezone":"Europe/…
✅ Icone PWA aggiornate per utente 9 con logo aziendale
✅ [desktop] Icone PWA per utente 9, icon length: 815939
8:46:34 AM [express] GET /api/client-app-info 200 in 299ms :: {"appName":"Gestionale Sanitario","ico…
🏢 [/api/company-name-settings] [desktop] GET per utente 9 (customer)
🏢 [/api/company-name-settings] [desktop] Settings per utente 9 (customer): {
  businessName: 'Studio Medico',
  showBusinessName: true,
  name: 'zambelli.andrea.1973A@gmail.com',
  fontSize: 24,
  fontFamily: 'Arial, sans-serif',
  fontStyle: 'normal',
  color: '#000000',
  enabled: true
}
8:46:34 AM [express] GET /api/company-name-settings 200 in 151ms :: {"businessName":"Studio Medico",…
8:46:34 AM [express] GET /api/contact-info 200 in 143ms :: {"email":"info@studiomedico.it","phone":"…
8:46:34 AM [express] GET /api/tenant-context 200 in 142ms :: {"userId":9,"userType":"customer","tena…
8:46:34 AM [express] GET /api/timezone-settings 200 in 137ms :: {"timezone":"Europe/Rome","offset":2}
🔍 PWA MANIFEST: Richiesta manifest dinamico
🔍 PWA MANIFEST: URL completo: /manifest.json
🔍 PWA MANIFEST: Query params: {}
🔍 PWA MANIFEST: Headers referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/dashboard
📱 DEBUG MANIFEST FORZATO: CHIAMATA RICEVUTA
🔍 PWA MANIFEST: Referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/dashboard
🔄 MANIFEST: Versione aggiornata: 1759913194400-default
🔍 PWA MANIFEST: Analizzando referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/dashboard
🔍 PWA MANIFEST: Query params: {}
📱 MANIFEST DINAMICO: Servendo manifest per Studio Medico (owner default)
📱 MANIFEST ICONE: ["/pwa-icon/96x96?owner=default&v=1759913194400.112&android=1","/pwa-icon/192x192?owner=default&v=1759913194400.112&android=1","/pwa-icon/512x512?owner=default&v=1759913194400.112&android=1"]
📱 MANIFEST ID: area-cliente-generic
📱 MANIFEST NAME: Studio Medico - Area Cliente
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
8:46:34 AM [express] GET /api/license/has-pro-access 304 in 141ms :: true
Recupero licenze per l'utente ID 9
8:46:34 AM [express] GET /api/license/has-business-access 304 in 141ms :: true
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
Trovate 1 licenze per l'utente 9
8:46:34 AM [express] GET /api/user-with-license 304 in 303ms :: {"id":9,"username":"zambelli.andrea.…
8:46:34 AM [express] GET /api/license/license-info 304 in 322ms :: {"hasLicense":true,"type":"trial"…
🔐 MIDDLEWARE isAuthenticated chiamato per GET /subscription
🔐 req.isAuthenticated(): true
🔐 req.user: zambelli.andrea.1973A@gmail.com (ID: 9)
🔐 Session ID: UpxosApf5lEd1N_1RRQ631FMoJUEnmpc
🔐 Cookies: session-id=s%3AUpxosApf5lEd1N_1RRQ631FMoJUEnmpc.AVig47vPxPbyc%2BfPDWu4DgT%2F07RTi3nminnbpDLLxr8
✅ Utente autenticato con successo in isAuthenticated middleware: zambelli.andrea.1973A@gmail.com tipo: customer
Recupero sottoscrizione per l'utente con ID 9
8:46:34 AM [express] GET /api/payments/plans 200 in 207ms :: [{"id":5,"name":"Base Mensile","descrip…
8:46:34 AM [express] GET /api/license/application-title 304 in 140ms :: {"title":"Gestionale Sanitar…
🔍 PWA MANIFEST: Richiesta manifest dinamico
🔍 PWA MANIFEST: URL completo: /manifest.json
🔍 PWA MANIFEST: Query params: {}
🔍 PWA MANIFEST: Headers referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
📱 DEBUG MANIFEST FORZATO: CHIAMATA RICEVUTA
🔍 PWA MANIFEST: Referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
🔄 MANIFEST: Versione aggiornata: 1759913194930-default
🔍 PWA MANIFEST: Analizzando referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
🔍 PWA MANIFEST: Query params: {}
📱 MANIFEST DINAMICO: Servendo manifest per Studio Medico (owner default)
📱 MANIFEST ICONE: ["/pwa-icon/96x96?owner=default&v=1759913194931.8743&android=1","/pwa-icon/192x192?owner=default&v=1759913194931.8743&android=1","/pwa-icon/512x512?owner=default&v=1759913194931.8743&android=1"]
📱 MANIFEST ID: area-cliente-generic
📱 MANIFEST NAME: Studio Medico - Area Cliente
8:46:34 AM [express] POST /api/timezone-settings 200 in 141ms :: {"success":true,"timezone":"Europe/…
🖼️ ICON PROXY: Richiesta icona 192x192 per owner default
✅ ICON PROXY: Servendo icona 192x192 per owner default, dimensione: 50811 bytes
8:46:35 AM [express] GET /api/timezone-settings 304 in 139ms :: {"timezone":"Europe/Rome","offset":2}
8:46:35 AM [express] GET /api/payments/subscription 200 in 426ms :: {"id":12,"userId":9,"planId":7,"…
8:46:35 AM [express] POST /api/timezone-settings 200 in 140ms :: {"success":true,"timezone":"Europe/…
8:46:35 AM [express] GET /api/timezone-settings 200 in 143ms :: {"timezone":"Europe/Rome","offset":2}
🔐 MIDDLEWARE isAuthenticated chiamato per GET /subscription
🔐 req.isAuthenticated(): true
🔐 req.user: zambelli.andrea.1973A@gmail.com (ID: 9)
🔐 Session ID: UpxosApf5lEd1N_1RRQ631FMoJUEnmpc
🔐 Cookies: session-id=s%3AUpxosApf5lEd1N_1RRQ631FMoJUEnmpc.AVig47vPxPbyc%2BfPDWu4DgT%2F07RTi3nminnbpDLLxr8
✅ Utente autenticato con successo in isAuthenticated middleware: zambelli.andrea.1973A@gmail.com tipo: customer
Recupero sottoscrizione per l'utente con ID 9
8:46:35 AM [express] GET /api/license/has-pro-access 304 in 137ms :: true
8:46:35 AM [express] GET /api/payments/plans 200 in 208ms :: [{"id":5,"name":"Base Mensile","descrip…
8:46:35 AM [express] GET /api/license/has-business-access 304 in 140ms :: true
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
Recupero licenze per l'utente ID 9
8:46:35 AM [express] GET /api/user-with-license 304 in 219ms :: {"id":9,"username":"zambelli.andrea.…
8:46:35 AM [express] GET /api/payments/subscription 200 in 415ms :: {"id":12,"userId":9,"planId":7,"…
Trovate 1 licenze per l'utente 9
8:46:35 AM [express] GET /api/license/application-title 304 in 141ms :: {"title":"Gestionale Sanitar…
8:46:35 AM [express] GET /api/license/license-info 304 in 210ms :: {"hasLicense":true,"type":"trial"…
8:46:35 AM [express] GET /api/tenant-context 200 in 143ms :: {"userId":9,"userType":"customer","tena…
🖼️ ICON PROXY: Richiesta icona 192x192 per owner default
✅ ICON PROXY: Servendo icona 192x192 per owner default, dimensione: 50811 bytes
🔍 PWA MANIFEST: Richiesta manifest dinamico
🔍 PWA MANIFEST: URL completo: /manifest.json
🔍 PWA MANIFEST: Query params: {}
🔍 PWA MANIFEST: Headers referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
📱 DEBUG MANIFEST FORZATO: CHIAMATA RICEVUTA
🔍 PWA MANIFEST: Referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
🔄 MANIFEST: Versione aggiornata: 1759913195877-default
🔍 PWA MANIFEST: Analizzando referer: https://d6546abb-db52-44bc-b646-7127baec287e-00-yym34ng3ao7z.worf.replit.dev/subscribe
🔍 PWA MANIFEST: Query params: {}
📱 MANIFEST DINAMICO: Servendo manifest per Studio Medico (owner default)
📱 MANIFEST ICONE: ["/pwa-icon/96x96?owner=default&v=1759913195877.0137&android=1","/pwa-icon/192x192?owner=default&v=1759913195877.0137&android=1","/pwa-icon/512x512?owner=default&v=1759913195877.0137&android=1"]
📱 MANIFEST ID: area-cliente-generic
📱 MANIFEST NAME: Studio Medico - Area Cliente
8:46:36 AM [express] POST /api/timezone-settings 200 in 140ms :: {"success":true,"timezone":"Europe/…
8:46:36 AM [express] GET /api/timezone-settings 304 in 139ms :: {"timezone":"Europe/Rome","offset":2}
8:46:36 AM [express] POST /api/timezone-settings 200 in 137ms :: {"success":true,"timezone":"Europe/…
🖼️ ICON PROXY: Richiesta icona 192x192 per owner default
✅ ICON PROXY: Servendo icona 192x192 per owner default, dimensione: 50811 bytes
8:46:36 AM [express] GET /api/tenant-context 200 in 146ms :: {"userId":9,"userType":"customer","tena…
8:46:36 AM [express] POST /api/timezone-settings 200 in 147ms :: {"success":true,"timezone":"Europe/…
8:46:37 AM [express] GET /api/google-auth/status 200 in 144ms
8:46:37 AM [express] GET /api/google-auth/status 200 in 152ms
🔐 [desktop] /api/user-with-license per utente 9 (zambelli.andrea.1973A@gmail.com)
Recupero licenze per l'utente ID 9
Recupero licenze per l'utente ID 9
8:46:49 AM [express] GET /api/timezone-settings 200 in 144ms :: {"timezone":"Europe/Rome","offset":2}
8:46:49 AM [express] GET /api/license/application-title 304 in 141ms :: {"title":"Gestionale Sanitar…
8:46:49 AM [express] GET /api/license/has-business-access 304 in 141ms :: true
Trovate 1 licenze per l'utente 9
📱💻 [desktop] Dati utente unificati: {
  id: 9,
  username: 'zambelli.andrea.1973A@gmail.com',
  firstName: null,
  lastName: null,
  licenseType: 'trial'
}
Trovate 1 licenze per l'utente 9
8:46:49 AM [express] GET /api/user-with-license 304 in 211ms :: {"id":9,"username":"zambelli.andrea.…
8:46:49 AM [express] GET /api/license/license-info 304 in 213ms :: {"hasLicense":true,"type":"trial"…
🔐 MIDDLEWARE isAuthenticated chiamato per GET /subscription
🔐 req.isAuthenticated(): true
🔐 req.user: zambelli.andrea.1973A@gmail.com (ID: 9)
🔐 Session ID: UpxosApf5lEd1N_1RRQ631FMoJUEnmpc
🔐 Cookies: session-id=s%3AUpxosApf5lEd1N_1RRQ631FMoJUEnmpc.AVig47vPxPbyc%2BfPDWu4DgT%2F07RTi3nminnbpDLLxr8
✅ Utente autenticato con successo in isAuthenticated middleware: zambelli.andrea.1973A@gmail.com tipo: customer
Recupero sottoscrizione per l'utente con ID 9
8:46:49 AM [express] GET /api/license/has-pro-access 304 in 444ms :: true
8:46:49 AM [express] GET /api/timezone-settings 304 in 150ms :: {"timezone":"Europe/Rome","offset":2}
8:46:49 AM [express] POST /api/timezone-settings 200 in 141ms :: {"success":true,"timezone":"Europe/…
8:46:49 AM [express] GET /api/payments/plans 200 in 220ms :: [{"id":5,"name":"Base Mensile","descrip…
8:46:49 AM [express] GET /api/tenant-context 200 in 139ms :: {"userId":9,"userType":"customer","tena…
8:46:49 AM [express] POST /api/timezone-settings 200 in 142ms :: {"success":true,"timezone":"Europe/…
8:46:49 AM [express] GET /api/payments/subscription 200 in 477ms :: {"id":12,"userId":9,"planId":7,"…
🔐 MIDDLEWARE isAuthenticated chiamato per POST /stripe/create-checkout-session
🔐 req.isAuthenticated(): true
🔐 req.user: zambelli.andrea.1973A@gmail.com (ID: 9)
🔐 Session ID: UpxosApf5lEd1N_1RRQ631FMoJUEnmpc
🔐 Cookies: session-id=s%3AUpxosApf5lEd1N_1RRQ631FMoJUEnmpc.AVig47vPxPbyc%2BfPDWu4DgT%2F07RTi3nminnbpDLLxr8
✅ Utente autenticato con successo in isAuthenticated middleware: zambelli.andrea.1973A@gmail.com tipo: customer
Recupero metodi di pagamento configurati
Recuperati 4 metodi di pagamento configurati
🔐 Stripe: usando chiave dal DATABASE TEST 🧪
Stripe: Prefisso chiave: sk_test_...
Stripe session creata: {
  id: 'cs_test_a1Sjjnxo2QE4HbDD1XQeOcmTkymB62v4VtJ0LoS4xiwtus40YVPbLwJsnm',
  url: 'https://checkout.stripe.com/c/pay/cs_test_a1Sjjnxo2QE4HbDD1XQeOcmTkymB62v4VtJ0LoS4xiwtus40YVPbLwJsnm#fidnandhYHdWcXxpYCc%2FJ2FgY2RwaXEnKSdkdWxOYHwnPyd1blpxYHZxWjA0V0JnQTxGZDNDPTZfN05HXF1ETlNRb01yTWdmaGtgfEs1amJ%2FMWA2bzZTRG9NQG50fXNsaj1BdUJpS189bzdvUGZ8YzxiYVxfdW9wRG9pTjcxZ3NKfGlqNTU8RF9jaktOcCcpJ2N3amhWYHdzYHcnP3F3cGApJ2dkZm5id2pwa2FGamlqdyc%2FJyZjY2NjY2MnKSdpZHxqcHFRfHVgJz8ndmxrYmlgWmxxYGgnKSdga2RnaWBVaWRmYG1qaWFgd3YnP3F3cGB4JSUl',
  hasUrl: true,
  mode: 'payment',
  status: 'open'
}
Recupero sottoscrizione per l'utente con ID 9
Abbonamento esistente trovato (ID: 12), lo aggiorno invece di crearne uno nuovo
Aggiornamento abbonamento ID: 12 con dati: {
  planId: 7,
  status: 'pending',
  currentPeriodStart: 2025-10-08T08:46:56.946Z,
  currentPeriodEnd: 2025-11-08T08:46:56.946Z,
  cancelAtPeriodEnd: false,
  stripeSessionId: 'cs_test_a1Sjjnxo2QE4HbDD1XQeOcmTkymB62v4VtJ0LoS4xiwtus40YVPbLwJsnm',
  paymentMethod: 'stripe'
}
Abbonamento aggiornato: {
  id: 12,
  userId: 9,
  planId: 7,
  status: 'pending',
  currentPeriodStart: 2025-10-08T08:46:56.946Z,
  currentPeriodEnd: 2025-11-08T08:46:56.946Z,
  cancelAtPeriodEnd: false,
  paypalSubscriptionId: '5KY74785FX201082N',
  wiseSubscriptionId: null,
  stripeCustomerId: null,
  stripeSubscriptionId: null,
  stripeSessionId: 'cs_test_a1Sjjnxo2QE4HbDD1XQeOcmTkymB62v4VtJ0LoS4xiwtus40YVPbLwJsnm',
  paymentMethod: 'stripe',
  metadata: null,
  createdAt: 2025-10-07T13:17:02.314Z,
  updatedAt: 2025-10-07T13:17:02.314Z
}
8:46:57 AM [express] POST /api/payments/stripe/create-checkout-session 200 in 1117ms :: {"success":t…
8:49:36 AM [express] GET /api/timezone-settings 200 in 3441ms :: {"timezone":"Europe/Rome","offset":…
🔐 MIDDLEWARE isAuthenticated chiamato per GET /subscription
🔐 req.isAuthenticated(): true
🔐 req.user: zambelli.andrea.1973A@gmail.com (ID: 9)
🔐 Session ID: UpxosApf5lEd1N_1RRQ631FMoJUEnmpc
🔐 Cookies: session-id=s%3AUpxosApf5lEd1N_1RRQ631FMoJUEnmpc.AVig47vPxPbyc%2BfPDWu4DgT%2F07RTi3nminnbpDLLxr8
✅ Utente autenticato con successo in isAuthenticated middleware: zambelli.andrea.1973A@gmail.com tipo: customer
Recupero sottoscrizione per l'utente con ID 9
8:49:36 AM [express] GET /api/tenant-context 200 in 3407ms :: {"userId":9,"userType":"customer","ten…
8:49:36 AM [express] POST /api/timezone-settings 200 in 142ms :: {"success":true,"timezone":"Europe/…
8:49:37 AM [express] POST /api/timezone-settings 200 in 143ms :: {"success":true,"timezone":"Europe/…
8:49:37 AM [express] GET /api/payments/subscription 200 in 3971ms :: {"id":12,"userId":9,"planId":7,…
8:49:38 AM [express] GET /api/payments/plans 200 in 5734ms :: [{"id":5,"name":"Base Mensile","descri…
